/**
 * Ordering Element
 *
 * @copyright: Copyright (C) 2024 Jlowcode Org - All rights reserved.
 * @license:   GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
define(["jquery","fab/element","fab/encoder","fab/fabrik"],(function(e,t,n,i,o){return FbOrdering=new Class({Extends:t,options:{tags:[]},initialize:function(e,t){this.setPlugin("ordering"),this.parent(e,t),this.init()},init:function(){var t=this,n=e(t.element).find(".tree-ordering-single");0!=t.options.refTree?"null"!==typeOf(this.element)&&(t.configureRefTree(t.options.refTree),t.buildTree(t.options.defaultTree?t.options.defaultTree:""),n.off("tree.click").on("tree.click",(function(e){var n=e.node;t.addTag(n.name,n.id,!0)}))):console.warn(Joomla.JText._("PLG_FABRIK_ELEMENT_ORDERING_TYPE_REF_ELEMENT_ERROR"))},buildTree:function(t){const n=this;e.ajax({url:"",method:"post",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",g:"element",plugin:"ordering",method:"getTree",value:t,listId:n.options.listId,refTreeId:n.options.refTreeId,htmlName:n.options.element}}).done((function(t){var n=JSON.parse(t),i=e("#"+n.htmlName).find(".tree-ordering-single");if(n.success){var o=n.data,a=[];if(0==o.length)return i.closest(".fabrikSubElementContainer").find(".tag-container").html(""),i.closest(".fabrikSubElementContainer").find(".tag-container").css("display","none"),i.html(Joomla.JText._("PLG_FABRIK_ELEMENT_ORDERING_NO_CHILDREN")),void i.css("color","#666");o.forEach((e=>{var t=[];t.id=e[0],t.name=e[1],a.push(t)})),i.tree({data:a,selectable:!1}),i.tree("loadData",a)}else console.warn(n.msg)}))},configureRefTree:function(t){var n=this;e("#"+t).find(".jqtree_common");e("#"+t).on("click",(function(){value=e(this).find('input[name="'+t+'[]"]').val(),n.buildTree(value)}))},addTag:function(t,n){var i=this,o={id:n,text:t,container:document.createElement("div"),content:document.createElement("span"),input:document.createElement("input"),closeButton:document.createElement("span")};o.container.classList.add("tag-container"),o.content.classList.add("tag-content"),o.closeButton.classList.add("tag-close-button"),o.input.value=n,o.input.setAttribute("type","checkbox"),o.input.setAttribute("style","display: none"),o.input.setAttribute("checked","checked"),o.input.setAttribute("name",i.options.elName),o.input.setAttribute("hidden",!0),e(i.element).find(".selected-checkbox").append(o.input),o.content.textContent=o.text,o.closeButton.textContent="x",o.closeButton.addEventListener("click",(function(){i.removeTag(i.options.tags.indexOf(o))})),o.container.appendChild(o.content),o.container.appendChild(o.closeButton),i.removeTag(0),i.options.tags[0]=o,tree=e(i.element).find(".tree-ordering-single"),e(i.element).find(".tree-ordering").before(o.container)},removeTag:function(t){var n=this.options.tags[t];n&&(this.options.tags.splice(t,1),e(n.container).remove(),e(n.input).remove())}}),FbOrdering}));